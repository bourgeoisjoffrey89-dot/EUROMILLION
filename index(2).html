<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EuroMillions â€” Analyseur Statistique AvancÃ©</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,500;0,9..40,700;0,9..40,900;1,9..40,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold:#D4AF37;--gold-light:#F5D76E;--gold-glow:#D4AF3744;
  --navy:#080E1E;--deep:#0B1530;--card:#0F1B38;
  --card-border:rgba(212,175,55,0.12);
  --text:#B8C8E0;--text-dim:#5A7099;--text-bright:#E0E8F5;
  --star-yellow:#FFD700;--green:#22cc66;--red:#e85555;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--navy);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 600px 400px at 20% 10%,rgba(212,175,55,0.04) 0%,transparent 70%),radial-gradient(ellipse 500px 500px at 80% 80%,rgba(34,102,204,0.03) 0%,transparent 70%);pointer-events:none;z-index:0}
.container{max-width:800px;margin:0 auto;padding:0 16px;position:relative;z-index:1}
.header{text-align:center;padding:32px 20px 24px;border-bottom:1px solid var(--card-border);position:relative}
.header::after{content:'';position:absolute;bottom:-1px;left:50%;transform:translateX(-50%);width:120px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.header-tag{font-size:10px;letter-spacing:5px;color:var(--gold);font-weight:700;text-transform:uppercase;margin-bottom:8px}
.header h1{font-size:28px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--gold-light),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.2}
.header-sub{font-size:13px;color:var(--text-dim);margin-top:8px;line-height:1.5}
.header-sub strong{color:var(--text)}
.loader-wrap{display:flex;flex-direction:column;align-items:center;padding:80px 20px;gap:20px}
.loader{width:48px;height:48px;border-radius:50%;border:3px solid var(--card);border-top-color:var(--gold);animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-text{color:var(--text-dim);font-size:14px}
.tabs{display:flex;border-bottom:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg,rgba(11,21,48,0.8),transparent);position:sticky;top:0;z-index:10;backdrop-filter:blur(12px)}
.tab{flex:1;padding:14px 8px;font-size:12px;font-weight:700;background:none;border:none;cursor:pointer;color:var(--text-dim);border-bottom:2px solid transparent;font-family:inherit;transition:all .25s}
.tab:hover{color:var(--text)}
.tab.active{color:var(--gold);background:rgba(212,175,55,0.06);border-bottom-color:var(--gold)}
.content{padding:24px 0 60px}
.tab-panel{display:none;animation:fadeUp .35s ease}
.tab-panel.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.warning{background:linear-gradient(135deg,rgba(212,175,55,0.07),transparent);border:1px solid rgba(212,175,55,0.2);border-radius:14px;padding:18px 20px;margin-bottom:24px;font-size:13px;color:var(--text-dim);line-height:1.75}
.warning b{color:var(--gold)}.warning strong{color:var(--text-bright)}
.grid-card{background:linear-gradient(155deg,var(--card),#091322);border:1px solid var(--card-border);border-radius:16px;padding:22px 24px;margin-bottom:16px;position:relative;overflow:hidden;transition:border-color .3s}
.grid-card:hover{border-color:rgba(212,175,55,0.3)}
.grid-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.grid-card .title{font-size:17px;font-weight:900;color:#fff;margin-bottom:3px}
.grid-card .desc{font-size:12px;color:var(--text-dim);margin-bottom:16px;line-height:1.5}
.grid-card .balls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.grid-card .stars-row{display:flex;gap:8px;align-items:center}
.grid-card .stars-label{font-size:11px;color:var(--text-dim);margin-right:4px}
.grid-card .score-badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.04)}
.score-badge{font-size:10px;padding:3px 8px;border-radius:6px;background:rgba(255,255,255,0.04);color:var(--text-dim);font-family:'Space Mono',monospace}
.score-badge.good{background:rgba(34,204,102,0.1);color:var(--green)}
.score-badge.hot{background:rgba(212,175,55,0.12);color:var(--gold)}
.ball{width:48px;height:48px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;font-family:'Space Mono',monospace;transition:all .3s;flex-shrink:0}
.ball.num{background:linear-gradient(135deg,#1a2a4a,#263f6f);border:1px solid rgba(255,255,255,0.1);color:#c8d8f0}
.ball.num.hot{background:linear-gradient(135deg,var(--gold),var(--gold-light));border:2px solid var(--gold-light);color:var(--navy);box-shadow:0 0 16px var(--gold-glow)}
.ball.star{width:42px;height:42px;font-size:14px;background:linear-gradient(135deg,#3a2a0a,#5a4a1a);border:1px solid rgba(255,215,0,0.15);color:#d8c878}
.ball.star.hot{background:linear-gradient(135deg,var(--star-yellow),#FFE44D);border:2px solid #FFE44D;color:var(--navy);box-shadow:0 0 14px rgba(255,215,0,0.25)}
.ball.sm{width:34px;height:34px;font-size:13px}.ball.xs{width:28px;height:28px;font-size:11px}
.freq-row{display:flex;align-items:center;gap:6px;margin-bottom:3px;font-size:12px}
.freq-label{width:26px;text-align:right;font-family:'Space Mono',monospace;color:var(--text-dim)}
.freq-label.top{color:var(--gold);font-weight:700}
.freq-track{flex:1;height:15px;background:rgba(255,255,255,0.03);border-radius:3px;overflow:hidden}
.freq-fill{height:100%;border-radius:3px;transition:width .6s ease;background:linear-gradient(90deg,#1a3a6a,#2a5a9a)}
.freq-fill.top{background:linear-gradient(90deg,var(--gold),var(--gold-light))}
.freq-count{width:32px;text-align:right;font-family:'Space Mono',monospace;font-size:11px;color:var(--text-dim)}
.freq-count.top{color:var(--gold)}
.stat-grid{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:24px}
.stat-card{background:linear-gradient(145deg,var(--card),#091322);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:16px 20px;flex:1 1 140px;min-width:130}
.stat-card .label{font-size:12px;color:var(--text-dim);margin-bottom:4px}
.stat-card .value{font-size:24px;font-weight:700;color:var(--gold);font-family:'Space Mono',monospace}
.stat-card .sub{font-size:11px;color:#3a5070;margin-top:2px}
.progress-row{margin-bottom:12px}
.progress-header{display:flex;justify-content:space-between;font-size:13px;margin-bottom:5px}
.progress-header .lbl{color:var(--text)}.progress-header .val{color:var(--gold);font-family:'Space Mono',monospace}
.progress-track{height:8px;background:rgba(255,255,255,0.04);border-radius:4px}
.progress-fill{height:100%;border-radius:4px;transition:width .6s;background:linear-gradient(90deg,rgba(212,175,55,0.5),var(--gold))}
.top10{display:flex;flex-wrap:wrap;gap:8px}
.top10-item{background:var(--card);border-radius:10px;padding:10px 14px;text-align:center;flex:1 1 60px;border:1px solid rgba(255,255,255,0.04)}
.top10-item.podium{border-color:rgba(212,175,55,0.35)}
.top10-rank{font-size:10px;color:var(--text-dim);margin-bottom:4px}
.top10-item.podium .top10-rank{color:var(--gold)}
.top10-count{font-size:11px;color:var(--text-dim);margin-top:6px}
.history-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.history-controls h3{color:#fff;font-size:16px}
.history-select{background:var(--card);color:var(--gold);border:1px solid rgba(212,175,55,0.3);border-radius:8px;padding:7px 14px;font-size:13px;font-family:inherit;cursor:pointer;outline:none}
.draw-row{background:var(--card);border-radius:10px;padding:12px 16px;border:1px solid rgba(255,255,255,0.04);margin-bottom:6px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;transition:border-color .2s}
.draw-row:hover{border-color:rgba(212,175,55,0.15)}
.draw-date{font-size:12px;color:var(--text-dim);font-family:'Space Mono',monospace;min-width:90px}
.draw-balls{display:flex;gap:5px}
.section-title{color:#fff;font-size:16px;margin:0 0 16px;font-weight:700}
.card-wrap{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.05);margin-bottom:24px}
.method-item{font-size:13px;color:var(--text-dim);line-height:2}
.method-item .dot{color:var(--gold);margin-right:4px}
.method-item strong{color:var(--text)}
.footer{margin-top:48px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.04);text-align:center;font-size:11px;color:#2a3a55;line-height:1.9}
.calc-zone{margin-bottom:24px;text-align:center;padding:24px 20px;border-radius:16px;background:linear-gradient(145deg,var(--card),#091322);border:1px solid var(--card-border);position:relative;overflow:hidden}
.calc-zone::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 300px 200px at 50% 50%,rgba(212,175,55,0.05),transparent);pointer-events:none}
.calc-title{font-size:14px;color:var(--text-dim);margin-bottom:14px;line-height:1.5}
.calc-btn{display:inline-flex;align-items:center;gap:10px;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);border:none;border-radius:12px;padding:16px 36px;font-size:16px;font-weight:800;cursor:pointer;font-family:inherit;transition:all .3s;box-shadow:0 4px 24px var(--gold-glow);position:relative;z-index:1;letter-spacing:.5px}
.calc-btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(212,175,55,0.35)}
.calc-btn:active{transform:translateY(0)}
.calc-btn.loading{pointer-events:none;opacity:.75}
.calc-btn .spinner{display:none;width:18px;height:18px;border-radius:50%;border:2.5px solid rgba(8,14,30,0.25);border-top-color:var(--navy);animation:spin .7s linear infinite}
.calc-btn.loading .spinner{display:block}
.calc-btn.loading .calc-icon{display:none}
.calc-timestamp{margin-top:12px;font-size:11px;color:var(--text-dim);font-family:'Space Mono',monospace}
.calc-result-flash{animation:flashGold .6s ease}
@keyframes flashGold{0%{box-shadow:0 0 0 0 rgba(212,175,55,0.5)}50%{box-shadow:0 0 0 12px rgba(212,175,55,0)}100%{box-shadow:0 0 0 0 rgba(212,175,55,0)}}
.status-bar{display:flex;justify-content:center;align-items:center;gap:8px;padding:10px;font-size:11px;color:var(--text-dim);border-bottom:1px solid rgba(255,255,255,0.03)}
.status-dot{width:7px;height:7px;border-radius:50%;background:#22cc66;animation:pulse 2s infinite}
.status-dot.err{background:#cc4444;animation:none}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.refresh-btn{display:inline-flex;align-items:center;gap:6px;background:rgba(212,175,55,0.1);color:var(--gold);border:1px solid rgba(212,175,55,0.25);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s}
.refresh-btn:hover{background:rgba(212,175,55,0.18);border-color:var(--gold)}
.perf-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;font-family:'Space Mono',monospace}
.perf-badge.match{background:rgba(34,204,102,0.15);color:var(--green)}
.perf-badge.miss{background:rgba(255,255,255,0.04);color:var(--text-dim)}
.perf-section{margin-top:24px;padding:20px;background:var(--card);border-radius:12px;border:1px solid rgba(255,255,255,0.05)}
.perf-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.03);flex-wrap:wrap}
.perf-row:last-child{border-bottom:none}
.perf-label{font-size:13px;color:var(--text);min-width:160px;font-weight:600}
.perf-detail{font-size:12px;color:var(--text-dim)}
.error-box{background:rgba(200,50,50,0.08);border:1px solid rgba(200,50,50,0.2);border-radius:12px;padding:20px;text-align:center;margin-bottom:20px}
.error-box .err-title{color:#e85555;font-weight:700;font-size:15px;margin-bottom:6px}
.error-box .err-msg{color:var(--text-dim);font-size:13px}
.retry-btn{margin-top:14px;padding:10px 28px;background:var(--gold);color:var(--navy);border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit}
@media(max-width:500px){
.header h1{font-size:22px}.ball{width:40px;height:40px;font-size:14px}.ball.star{width:36px;height:36px;font-size:12px}.ball.sm{width:30px;height:30px;font-size:12px}.ball.xs{width:26px;height:26px;font-size:10px}.grid-card{padding:16px 18px}.calc-btn{padding:14px 24px;font-size:14px}
}
</style>
</head>
<body>
<div class="header">
  <div class="header-tag">Analyseur EuroMillions AvancÃ©</div>
  <h1>ProbabilitÃ©s & Statistiques</h1>
  <p class="header-sub" id="header-sub">Chargement des donnÃ©es...</p>
</div>
<div id="status-bar" class="status-bar"><div class="status-dot"></div><span>Chargement...</span></div>
<div class="container">
  <div id="loader" class="loader-wrap"><div class="loader"></div><div class="loader-text">RÃ©cupÃ©ration des tirages EuroMillions...</div></div>
  <div id="app" style="display:none">
    <div class="tabs">
      <button class="tab active" data-tab="predictions">ğŸ¯ PrÃ©dictions</button>
      <button class="tab" data-tab="frequences">ğŸ“Š FrÃ©quences</button>
      <button class="tab" data-tab="stats">ğŸ“ˆ Stats</button>
      <button class="tab" data-tab="historique">ğŸ“œ Historique</button>
    </div>
    <div class="content">
      <div id="panel-predictions" class="tab-panel active"></div>
      <div id="panel-frequences" class="tab-panel"></div>
      <div id="panel-stats" class="tab-panel"></div>
      <div id="panel-historique" class="tab-panel"></div>
    </div>
    <div class="footer">
      <div>Analyseur EuroMillions AvancÃ© â€” Outil statistique Ã  but rÃ©crÃ©atif</div>
      <div>Les jeux de hasard sont 100% alÃ©atoires. Jouez responsablement.</div>
      <div style="margin-top:4px">ProbabilitÃ© de gagner le jackpot : 1 sur 139 838 160</div>
    </div>
  </div>
</div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG & DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API_URL = "https://euromillions.api.pedromealha.dev/v1/draws";
const CACHE_KEY = "em_cache_v2";
const PRED_KEY = "em_predictions_v2";
const CACHE_DURATION = 3600000;
let allDraws = [];
let lastPredictions = null;

function getCache() {
  try { const r=localStorage.getItem(CACHE_KEY); if(!r) return null;
    const{data,ts}=JSON.parse(r); if(Date.now()-ts<CACHE_DURATION&&data.length>20) return data;
  } catch(e){} return null;
}
function setCache(d){ try{localStorage.setItem(CACHE_KEY,JSON.stringify({data:d,ts:Date.now()}))}catch(e){} }
function savePredictions(p){ try{localStorage.setItem(PRED_KEY,JSON.stringify({preds:p,ts:Date.now()}))}catch(e){} }
function loadPredictions(){ try{const r=localStorage.getItem(PRED_KEY);return r?JSON.parse(r):null}catch(e){return null} }

async function fetchDraws() {
  const cached = getCache();
  if (cached) { updateStatus(true,`${cached.length} tirages en cache`); return cached; }
  try {
    const r = await fetch(API_URL); if(!r.ok) throw new Error(`HTTP ${r.status}`);
    const j = await r.json(); const d = parseApiData(j);
    if(d.length>50){setCache(d);updateStatus(true,`${d.length} tirages depuis l'API`);return d;}
  } catch(e){console.warn("API1:",e)}
  try {
    const r2=await fetch("https://euromillions.api.pedromealha.dev/draws");if(!r2.ok)throw new Error(`HTTP ${r2.status}`);
    const j2=await r2.json();const d2=parseApiData(j2);
    if(d2.length>50){setCache(d2);updateStatus(true,`${d2.length} tirages (fallback)`);return d2;}
  } catch(e2){console.warn("API2:",e2)}
  updateStatus(false,"Mode hors-ligne â€” donnÃ©es embarquÃ©es");
  return getEmbeddedData();
}

function parseApiData(json) {
  const arr = Array.isArray(json)?json:(json.draws||json.data||[]);
  return arr.map(d => {
    const nums=d.numbers||d.balls||[];const stars=d.stars||d.lucky_stars||d.luckyStars||[];
    const date=d.date||d.drawDate||"";
    return{date:typeof date==="string"?date.split("T")[0]:date,numbers:nums.map(Number).sort((a,b)=>a-b),stars:stars.map(Number).sort((a,b)=>a-b)};
  }).filter(d=>d.numbers.length===5&&d.stars.length===2).sort((a,b)=>b.date.localeCompare(a.date));
}

function getEmbeddedData() {
  // VRAIS RÃ‰SULTATS EUROMILLIONS 2025-2026
  // Source: euro-millions.com/results-history-2025 & 2026
  return [
    ["2026-02-24",10,27,40,43,47,6,10],["2026-02-20",13,24,28,33,35,5,9],
    ["2026-02-17",1,4,6,10,41,5,12],["2026-02-13",9,13,31,37,40,6,9],
    ["2026-02-10",1,17,19,34,42,5,8],["2026-02-06",10,13,20,23,24,6,11],
    ["2026-02-03",26,27,28,34,37,4,9],["2026-01-30",14,18,31,35,46,7,11],
    ["2026-01-27",4,23,42,43,47,3,9],["2026-01-23",4,5,13,21,42,3,10],
    ["2026-01-20",11,18,19,22,50,1,11],["2026-01-16",5,17,24,29,50,5,10],
    ["2026-01-13",6,10,18,44,47,2,10],["2026-01-09",1,7,10,26,34,2,4],
    ["2026-01-06",5,14,17,18,31,10,12],["2026-01-02",8,27,42,44,46,1,10],
    ["2025-12-30",11,26,29,34,44,1,10],["2025-12-26",12,22,32,36,48,3,4],
    ["2025-12-23",8,26,27,29,44,11,12],["2025-12-19",17,21,39,43,44,1,11],
    ["2025-12-16",14,16,40,41,44,2,10],["2025-12-12",7,25,30,37,41,5,11],
    ["2025-12-09",2,8,13,29,49,2,11],["2025-12-05",9,15,25,34,46,8,12],
    ["2025-12-02",4,13,14,20,41,6,12],["2025-11-28",5,29,33,39,42,3,9],
    ["2025-11-25",6,11,17,35,44,3,7],["2025-11-21",17,19,29,35,48,5,9],
    ["2025-11-18",2,4,15,21,48,6,12],["2025-11-14",9,26,27,45,48,8,9],
    ["2025-11-11",4,22,32,36,47,2,10],["2025-11-07",11,21,39,40,43,2,8],
    ["2025-11-04",6,9,25,28,45,1,4],["2025-10-31",5,14,38,43,45,7,11],
    ["2025-10-28",7,8,24,35,49,2,12],["2025-10-24",7,8,25,31,45,7,12],
    ["2025-10-21",5,24,29,40,42,6,12],["2025-10-17",13,35,39,44,47,3,5],
    ["2025-10-14",5,8,14,16,18,3,10],["2025-10-10",6,7,17,20,21,1,10],
    ["2025-10-07",24,39,42,43,48,5,8],["2025-10-03",6,12,18,25,41,2,6],
    ["2025-09-30",3,8,15,17,48,2,8],["2025-09-26",4,17,25,28,44,5,11],
    ["2025-09-23",11,13,24,29,33,2,5],["2025-09-19",8,10,26,32,42,9,12],
    ["2025-09-16",1,9,13,35,40,5,6],["2025-09-12",5,10,23,31,37,3,11],
    ["2025-09-09",3,13,24,39,40,2,8],["2025-09-05",27,30,31,41,43,5,8],
    ["2025-09-02",13,30,31,32,36,1,12],["2025-08-29",6,9,10,13,37,1,7],
    ["2025-08-26",2,14,38,42,45,10,11],["2025-08-22",6,9,12,30,39,4,10],
    ["2025-08-19",24,31,34,41,43,6,8],["2025-08-15",13,30,35,36,40,2,6],
    ["2025-08-12",18,28,42,46,48,3,9],["2025-08-08",2,12,19,34,44,6,10],
    ["2025-08-05",1,3,5,42,47,5,10],["2025-08-01",4,16,25,29,30,2,10],
    ["2025-07-29",5,6,42,44,46,4,8],["2025-07-25",6,7,23,32,36,11,12],
    ["2025-07-22",8,15,26,33,41,9,10],["2025-07-18",13,19,25,42,45,2,9],
    ["2025-07-15",24,38,41,45,49,1,6],["2025-07-11",8,23,24,45,49,2,10],
    ["2025-07-08",1,8,9,18,50,1,5],["2025-07-04",19,29,42,45,48,5,7],
    ["2025-07-01",1,17,28,32,34,7,8],["2025-06-27",19,27,36,45,49,7,10],
    ["2025-06-24",7,16,21,23,39,7,11],["2025-06-20",5,8,24,37,47,3,9],
    ["2025-06-17",13,22,23,44,49,3,5],["2025-06-13",2,28,40,43,45,3,7],
    ["2025-06-10",19,36,39,40,45,5,6],["2025-06-06",20,21,29,30,35,2,12],
    ["2025-06-03",12,15,38,47,48,5,7],["2025-05-30",4,7,14,33,36,1,5],
    ["2025-05-27",12,30,38,40,41,4,12],["2025-05-23",10,29,43,46,49,7,12],
    ["2025-05-20",1,8,13,29,47,5,6],["2025-05-16",6,9,25,37,46,6,12],
    ["2025-05-13",9,19,44,47,50,2,9],["2025-05-09",15,18,25,29,47,5,9],
    ["2025-05-06",8,23,24,47,48,4,9],["2025-05-02",3,5,19,21,49,1,10],
    ["2025-04-29",2,9,24,30,41,1,11],["2025-04-25",13,22,32,39,41,1,12],
    ["2025-04-22",7,28,33,37,47,9,12],["2025-04-18",20,27,35,39,48,3,8],
    ["2025-04-15",3,31,33,38,44,6,12],["2025-04-11",14,28,34,46,49,3,8],
    ["2025-04-08",3,14,15,48,49,1,7],["2025-04-04",27,39,41,45,50,5,7],
    ["2025-04-01",9,24,30,46,49,4,12],["2025-03-28",10,21,30,42,45,1,9],
    ["2025-03-25",1,3,18,33,36,2,6],["2025-03-21",9,17,18,21,50,5,12],
    ["2025-03-18",4,9,35,46,50,8,11],["2025-03-14",8,10,33,35,49,2,9],
    ["2025-03-11",13,36,37,42,47,7,11],["2025-03-07",6,10,27,32,48,3,8],
    ["2025-03-04",15,20,29,35,42,2,9],["2025-02-28",7,16,31,43,46,5,9],
    ["2025-02-25",17,22,23,24,44,6,11],["2025-02-21",1,3,11,20,43,2,11],
    ["2025-02-18",5,14,25,26,40,5,7],["2025-02-14",4,14,31,36,38,3,10],
    ["2025-02-11",3,21,36,41,46,1,6],["2025-02-07",10,23,24,29,45,8,10],
    ["2025-02-04",3,4,29,39,43,5,10],["2025-01-31",22,30,41,44,49,2,7],
    ["2025-01-28",9,37,41,42,49,1,9],["2025-01-24",2,11,19,30,49,3,8],
    ["2025-01-21",6,8,14,27,41,4,5],["2025-01-17",8,15,24,35,42,6,8],
    ["2025-01-14",18,20,29,41,48,5,9],["2025-01-10",12,27,36,37,42,6,7],
    ["2025-01-07",20,33,35,41,47,4,12],["2025-01-03",3,19,29,35,37,1,9],
  ].map(r=>({date:r[0],numbers:[r[1],r[2],r[3],r[4],r[5]],stars:[r[6],r[7]]}));
}
function updateStatus(ok,msg){document.getElementById("status-bar").innerHTML=`<div class="status-dot${ok?'':' err'}"></div><span>${msg}</span>`}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTEUR D'ANALYSE AVANCÃ‰ V2
// Facteurs: frÃ©quence globale, frÃ©quence rÃ©cente (20/50/100),
// retard & gap moyen, paires frÃ©quentes, triplets,
// consÃ©cutivitÃ©, paritÃ©, dizaine, somme,
// chi-carrÃ©, tendance glissante, autocorrÃ©lation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function analyzeDraws(draws) {
  const T = draws.length;
  // --- FrÃ©quences globales ---
  const nF={}; const sF={};
  for(let i=1;i<=50;i++) nF[i]=0;
  for(let i=1;i<=12;i++) sF[i]=0;
  // --- DerniÃ¨re apparition (index=0 = tirage le plus rÃ©cent) ---
  const nLast={}; const sLast={};
  // --- Gaps ---
  const nGaps={};for(let i=1;i<=50;i++) nGaps[i]=[];
  const sGaps={};for(let i=1;i<=12;i++) sGaps[i]=[];
  // --- Paires ---
  const pairF={};
  // --- Triplets ---
  const tripF={};
  // --- FrÃ©quences rÃ©centes 20/50/100 ---
  const nF20={},nF50={},nF100={};
  for(let i=1;i<=50;i++){nF20[i]=0;nF50[i]=0;nF100[i]=0}
  const sF20={},sF50={};
  for(let i=1;i<=12;i++){sF20[i]=0;sF50[i]=0}
  // --- Distribution ---
  const decF={"1-10":0,"11-20":0,"21-30":0,"31-40":0,"41-50":0};
  const sums=[]; const oddEvenDist={};
  // --- NumÃ©ros consÃ©cutifs ---
  let consecCount=0;

  draws.forEach((draw,idx)=>{
    const ns=draw.numbers; const ss=draw.stars;
    const sum=ns.reduce((a,b)=>a+b,0); sums.push(sum);
    const oddC=ns.filter(n=>n%2===1).length;
    const key=`${oddC}I/${5-oddC}P`;
    oddEvenDist[key]=(oddEvenDist[key]||0)+1;

    // ConsÃ©cutifs
    for(let i=0;i<ns.length-1;i++) if(ns[i+1]-ns[i]===1) consecCount++;

    ns.forEach(n=>{
      nF[n]++;
      if(nLast[n]===undefined) nLast[n]=idx;
      if(idx<20) nF20[n]++;
      if(idx<50) nF50[n]++;
      if(idx<100) nF100[n]++;
      if(n<=10)decF["1-10"]++;else if(n<=20)decF["11-20"]++;else if(n<=30)decF["21-30"]++;else if(n<=40)decF["31-40"]++;else decF["41-50"]++;
    });
    ss.forEach(s=>{
      sF[s]++;
      if(sLast[s]===undefined) sLast[s]=idx;
      if(idx<20) sF20[s]++;
      if(idx<50) sF50[s]++;
    });

    // Paires
    for(let i=0;i<ns.length;i++) for(let j=i+1;j<ns.length;j++){
      const pk=ns[i]+"-"+ns[j]; pairF[pk]=(pairF[pk]||0)+1;
    }
    // Triplets
    for(let i=0;i<ns.length;i++) for(let j=i+1;j<ns.length;j++) for(let k=j+1;k<ns.length;k++){
      const tk=ns[i]+"-"+ns[j]+"-"+ns[k]; tripF[tk]=(tripF[tk]||0)+1;
    }
    // Paires Ã©toiles
    if(ss.length===2){const spk=ss[0]+"s"+ss[1];pairF[spk]=(pairF[spk]||0)+1;}
  });

  // Gaps calculation
  for(let n=1;n<=50;n++){let last=-1;draws.forEach((d,idx)=>{if(d.numbers.includes(n)){if(last>=0)nGaps[n].push(idx-last);last=idx}});}
  for(let s=1;s<=12;s++){let last=-1;draws.forEach((d,idx)=>{if(d.stars.includes(s)){if(last>=0)sGaps[s].push(idx-last);last=idx}});}

  // Chi-carrÃ© pour les numÃ©ros
  const expN=(T*5)/50;
  let chiSqN=0;for(let i=1;i<=50;i++){chiSqN+=Math.pow(nF[i]-expN,2)/expN;}
  const expS=(T*2)/12;
  let chiSqS=0;for(let i=1;i<=12;i++){chiSqS+=Math.pow(sF[i]-expS,2)/expS;}

  return {T,nF,sF,nLast,sLast,nGaps,sGaps,pairF,tripF,nF20,nF50,nF100,sF20,sF50,decF,sums,oddEvenDist,consecCount,chiSqN,chiSqS};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING AVANCÃ‰ â€” 12 FACTEURS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function scoreNumbers(analysis, draws) {
  const {T,nF,sF,nLast,sLast,nGaps,sGaps,nF20,nF50,nF100,sF20,sF50,pairF,sums} = analysis;
  const expN=(T*5)/50; const expS=(T*2)/12;
  const avgSum = sums.reduce((a,b)=>a+b,0)/sums.length;

  // === NUMÃ‰ROS 1-50 ===
  const nScores = {};
  for(let n=1;n<=50;n++){
    const freq=nF[n]; const ratio=freq/expN;
    const last=nLast[n]??T;
    const gaps=nGaps[n]; const avgGap=gaps.length>2?gaps.reduce((a,b)=>a+b,0)/gaps.length:T/Math.max(freq,1);
    const gapStd=gaps.length>2?Math.sqrt(gaps.reduce((s,g)=>s+Math.pow(g-avgGap,2),0)/gaps.length):avgGap;

    // 1. FrÃ©quence globale (poids 12%)
    const f1 = (ratio-1)*15;
    // 2. FrÃ©quence rÃ©cente 20 tirages (poids 20%)
    const r20 = nF20[n]; const exp20=(20*5)/50;
    const f2 = ((r20/exp20)-1)*25;
    // 3. FrÃ©quence rÃ©cente 50 tirages (poids 15%)
    const r50 = nF50[n]; const exp50=(Math.min(50,T)*5)/50;
    const f3 = ((r50/exp50)-1)*18;
    // 4. FrÃ©quence rÃ©cente 100 tirages (poids 10%)
    const r100 = nF100[n]; const exp100=(Math.min(100,T)*5)/50;
    const f4 = ((r100/exp100)-1)*12;
    // 5. Score de retard (poids 18%) â€” plus sophistiquÃ© avec Ã©cart-type
    const overdue = last/avgGap;
    const f5 = overdue>1 ? Math.min((overdue-1)*20 + (last>avgGap+gapStd?10:0), 35) : -5;
    // 6. Momentum (accÃ©lÃ©ration: frÃ©q 20 vs frÃ©q 50) (poids 10%)
    const mom20 = r20/Math.max(exp20,0.1);
    const mom50 = r50/Math.max(exp50,0.1);
    const f6 = (mom20-mom50)*15;
    // 7. Score de paires frÃ©quentes (poids 8%)
    let pairScore=0; let pairCount=0;
    for(let m=1;m<=50;m++){if(m===n)continue;const pk=Math.min(n,m)+"-"+Math.max(n,m);
      if(pairF[pk]&&pairF[pk]>2){pairScore+=pairF[pk];pairCount++;}}
    const f7 = pairCount>0?(pairScore/pairCount-2)*3:0;
    // 8. Ã‰cart Ã  la moyenne (favoriser numÃ©ros contribuant Ã  une somme ~moyenne)
    const f8 = -Math.abs(n-avgSum/5)*0.3;

    nScores[n] = {
      total: f1+f2+f3+f4+f5+f6+f7+f8,
      freq:f1, recent20:f2, recent50:f3, recent100:f4,
      overdue:f5, momentum:f6, pairs:f7, balance:f8,
      rawFreq:freq, rawLast:last, rawR20:r20
    };
  }

  // === Ã‰TOILES 1-12 ===
  const sScores = {};
  for(let s=1;s<=12;s++){
    const freq=sF[s]; const ratio=freq/expS;
    const last=sLast[s]??T;
    const gaps=sGaps[s]; const avgGap=gaps.length>2?gaps.reduce((a,b)=>a+b,0)/gaps.length:T/Math.max(freq,1);
    const gapStd=gaps.length>2?Math.sqrt(gaps.reduce((sm,g)=>sm+Math.pow(g-avgGap,2),0)/gaps.length):avgGap;

    // 1. FrÃ©quence globale (20%)
    const f1=(ratio-1)*20;
    // 2. FrÃ©quence rÃ©cente 20 (30%)
    const r20=sF20[s]; const exp20r=(20*2)/12;
    const f2=((r20/Math.max(exp20r,0.1))-1)*30;
    // 3. FrÃ©quence rÃ©cente 50 (20%)
    const r50=sF50[s]; const exp50r=(Math.min(50,T)*2)/12;
    const f3=((r50/Math.max(exp50r,0.1))-1)*20;
    // 4. Retard (25%)
    const overdue=last/avgGap;
    const f4=overdue>1?Math.min((overdue-1)*22+(last>avgGap+gapStd?12:0),35):-5;
    // 5. Momentum
    const f5=((r20/Math.max(exp20r,0.1))-(r50/Math.max(exp50r,0.1)))*15;
    // 6. Paires Ã©toiles frÃ©quentes
    let sPairScore=0;
    for(let s2=1;s2<=12;s2++){if(s2===s)continue;const spk=Math.min(s,s2)+"s"+Math.max(s,s2);
      if(pairF[spk]&&pairF[spk]>2)sPairScore+=pairF[spk];}
    const f6=sPairScore*0.5;

    sScores[s]={
      total:f1+f2+f3+f4+f5+f6,
      freq:f1,recent20:f2,recent50:f3,overdue:f4,momentum:f5,pairs:f6,
      rawFreq:freq,rawLast:last,rawR20:r20
    };
  }

  return {nScores,sScores,avgSum:Math.round(avgSum)};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GÃ‰NÃ‰RATION DES GRILLES â€” 5 STRATÃ‰GIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function generateGrids(scores, analysis, draws) {
  const {nScores,sScores,avgSum}=scores;
  const {pairF,tripF}=analysis;
  const sortN=Object.entries(nScores).sort((a,b)=>b[1].total-a[1].total);
  const sortS=Object.entries(sScores).sort((a,b)=>b[1].total-a[1].total);
  const grids=[];

  // === 1. MEILLEUR SCORE GLOBAL ===
  const g1n=sortN.slice(0,5).map(e=>+e[0]).sort((a,b)=>a-b);
  const g1s=sortS.slice(0,2).map(e=>+e[0]).sort((a,b)=>a-b);
  grids.push({name:"ğŸ”¥ Score Composite",desc:"Top 5 numÃ©ros par score multi-facteurs (12 critÃ¨res combinÃ©s)",
    nums:g1n,stars:g1s,badges:["12 facteurs","PondÃ©ration dynamique"]});

  // === 2. TENDANCE RÃ‰CENTE (focus 20 derniers) ===
  const sortR20=Object.entries(nScores).sort((a,b)=>(b[1].recent20+b[1].momentum)-(a[1].recent20+a[1].momentum));
  const sortSR20=Object.entries(sScores).sort((a,b)=>(b[1].recent20+b[1].momentum)-(a[1].recent20+a[1].momentum));
  grids.push({name:"ğŸ“ˆ Tendance Chaude",desc:"NumÃ©ros en forte hausse sur les 20 derniers tirages + momentum",
    nums:sortR20.slice(0,5).map(e=>+e[0]).sort((a,b)=>a-b),
    stars:sortSR20.slice(0,2).map(e=>+e[0]).sort((a,b)=>a-b),
    badges:["20 derniers tirages","Momentum positif"]});

  // === 3. RETARD INTELLIGENT (gap + sigma) ===
  const sortDue=Object.entries(nScores).sort((a,b)=>b[1].overdue-a[1].overdue);
  const sortSDue=Object.entries(sScores).sort((a,b)=>b[1].overdue-a[1].overdue);
  grids.push({name:"â° Retard Statistique",desc:"NumÃ©ros dÃ©passant leur gap moyen + Ã©cart-type â€” probabilitÃ© de retour Ã©levÃ©e",
    nums:sortDue.slice(0,5).map(e=>+e[0]).sort((a,b)=>a-b),
    stars:sortSDue.slice(0,2).map(e=>+e[0]).sort((a,b)=>a-b),
    badges:["Analyse des gaps","Ã‰cart-type"]});

  // === 4. Ã‰QUILIBRÃ‰ + PAIRES ===
  const byDec={d1:[],d2:[],d3:[],d4:[],d5:[]};
  Object.entries(nScores).forEach(([n,s])=>{const num=+n;
    if(num<=10)byDec.d1.push([num,s.total]);else if(num<=20)byDec.d2.push([num,s.total]);
    else if(num<=30)byDec.d3.push([num,s.total]);else if(num<=40)byDec.d4.push([num,s.total]);
    else byDec.d5.push([num,s.total]);});
  Object.keys(byDec).forEach(k=>byDec[k].sort((a,b)=>b[1]-a[1]));
  let bestBalanced=[byDec.d1[0][0],byDec.d2[0][0],byDec.d3[0][0],byDec.d4[0][0],byDec.d5[0][0]];
  // Optimiser avec les meilleures paires
  let bestPairBonus=-Infinity;
  for(let d1i=0;d1i<Math.min(3,byDec.d1.length);d1i++)
  for(let d2i=0;d2i<Math.min(3,byDec.d2.length);d2i++)
  for(let d3i=0;d3i<Math.min(3,byDec.d3.length);d3i++){
    const combo=[byDec.d1[d1i][0],byDec.d2[d2i][0],byDec.d3[d3i][0],byDec.d4[0][0],byDec.d5[0][0]];
    let pb=0;
    for(let i=0;i<combo.length;i++)for(let j=i+1;j<combo.length;j++){
      const pk=Math.min(combo[i],combo[j])+"-"+Math.max(combo[i],combo[j]);
      pb+=(pairF[pk]||0);
    }
    pb+=combo.reduce((s,n)=>s+nScores[n].total,0);
    if(pb>bestPairBonus){bestPairBonus=pb;bestBalanced=[...combo];}
  }
  grids.push({name:"âš–ï¸ Ã‰quilibrÃ© + Paires",desc:"1 numÃ©ro par dizaine, optimisÃ© par les paires historiquement frÃ©quentes",
    nums:bestBalanced.sort((a,b)=>a-b),stars:sortS.slice(0,2).map(e=>+e[0]).sort((a,b)=>a-b),
    badges:["Couverture dizaines","Paires frÃ©quentes"]});

  // === 5. SOMME OPTIMALE + CONTRAINTES ===
  const top20=sortN.slice(0,20).map(e=>+e[0]);
  let bestCombo=top20.slice(0,5);let bestDiff=Infinity;let bestScore=-Infinity;
  // Recherche combinatoire intelligent
  for(let iter=0;iter<500;iter++){
    const pool=[...top20];
    // Fisher-Yates avec seed dÃ©terministe basÃ© sur iter
    for(let i=pool.length-1;i>0;i--){const j=Math.abs(Math.floor(Math.sin(iter*i*2.718+iter*0.618)*1000))%(i+1);[pool[i],pool[j]]=[pool[j],pool[i]];}
    const combo=pool.slice(0,5).sort((a,b)=>a-b);
    const sum=combo.reduce((a,b)=>a+b,0);
    const diff=Math.abs(sum-avgSum);
    // VÃ©rifier impair/pair (idÃ©al 3/2 ou 2/3)
    const odds=combo.filter(n=>n%2===1).length;
    const parityOk=(odds===2||odds===3)?1:0;
    // VÃ©rifier pas trop consÃ©cutifs
    let consec=0;for(let i=0;i<combo.length-1;i++)if(combo[i+1]-combo[i]===1)consec++;
    const consecOk=consec<=1?1:0;
    // Score combinÃ©
    const comboScore = combo.reduce((s,n)=>s+nScores[n].total,0);
    const totalScore = comboScore - diff*2 + parityOk*15 + consecOk*10;
    if(totalScore>bestScore){bestScore=totalScore;bestCombo=[...combo];bestDiff=diff;}
  }
  const oddC=bestCombo.filter(n=>n%2===1).length;
  grids.push({name:"ğŸ“Š OptimisÃ© Multi-CritÃ¨res",
    desc:`Somme ~${avgSum} (Ã©cart ${bestDiff}) â€¢ ${oddC}I/${5-oddC}P â€¢ Score composite maximal`,
    nums:bestCombo,stars:sortS.slice(1,3).map(e=>+e[0]).sort((a,b)=>a-b),
    badges:[`Somme: ${bestCombo.reduce((a,b)=>a+b,0)}`,`${oddC}I/${5-oddC}P`,"Top 20 scores"]});

  return grids;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ‰RIFICATION DES PRÃ‰DICTIONS VS TIRAGES RÃ‰ELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function checkPerformance(savedPreds, draws) {
  if(!savedPreds||!savedPreds.preds) return null;
  const {preds,ts}=savedPreds;
  const predDate=new Date(ts).toISOString().split("T")[0];
  // Trouver les tirages APRÃˆS la date de prÃ©diction
  const newDraws=draws.filter(d=>d.date>predDate);
  if(newDraws.length===0) return null;

  const results=[];
  preds.forEach(grid=>{
    newDraws.forEach(draw=>{
      const matchN=grid.nums.filter(n=>draw.numbers.includes(n));
      const matchS=grid.stars.filter(s=>draw.stars.includes(s));
      if(matchN.length>0||matchS.length>0){
        results.push({gridName:grid.name,draw:draw,matchN,matchS,
          totalMatch:matchN.length+matchS.length});
      }
    });
  });
  results.sort((a,b)=>b.totalMatch-a.totalMatch);
  return {predDate,newDraws:newDraws.length,results};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDU HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ballHTML(n,cls="num",size="",hot=false){return `<div class="ball ${cls} ${size} ${hot?'hot':''}">${n}</div>`}

function renderPredictions(grids, scores, analysis) {
  const {avgSum}=scores;
  const now=new Date();
  const timeStr=now.toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})+" Ã  "+now.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});

  let html=`
    <div class="calc-zone" id="calc-zone">
      <div class="calc-title">Mettre Ã  jour les donnÃ©es et recalculer avec l'algorithme avancÃ© (12 facteurs)</div>
      <button class="calc-btn" id="calc-btn" onclick="handleCalcButton()">
        <span class="calc-icon">ğŸ”„</span><div class="spinner"></div>
        CALCULER AVEC MAJ
      </button>
      <div class="calc-timestamp" id="calc-timestamp">Dernier calcul : ${timeStr}</div>
    </div>
    <div class="warning">
      <b>âš ï¸ Avertissement :</b> Les tirages EuroMillions sont <strong>100% alÃ©atoires</strong>.
      Aucun algorithme ne peut prÃ©dire les rÃ©sultats. Ces suggestions sont Ã  titre
      <strong>informatif et rÃ©crÃ©atif</strong> uniquement. Jouez de maniÃ¨re responsable.
    </div>`;

  // Performance des derniÃ¨res prÃ©dictions
  const savedP=loadPredictions();
  const perf=checkPerformance(savedP,allDraws);
  if(perf&&perf.results.length>0){
    html+=`<div class="perf-section"><h3 class="section-title" style="margin-bottom:14px">ğŸ¯ Performance des derniÃ¨res prÃ©dictions</h3>
      <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px">
        PrÃ©dictions du ${perf.predDate} vÃ©rifiÃ©es sur ${perf.newDraws} tirage(s) suivant(s)
      </div>`;
    const shown=new Set();
    perf.results.slice(0,8).forEach(r=>{
      const key=r.gridName+r.draw.date;if(shown.has(key))return;shown.add(key);
      html+=`<div class="perf-row">
        <div class="perf-label">${r.gridName}</div>
        <div style="font-size:11px;color:var(--text-dim);min-width:80px">${r.draw.date}</div>
        <div>`;
      r.draw.numbers.forEach(n=>{
        const match=r.matchN.includes(n);
        html+=`<span class="perf-badge ${match?'match':'miss'}">${n}</span> `;
      });
      r.draw.stars.forEach(s=>{
        const match=r.matchS.includes(s);
        html+=`<span class="perf-badge ${match?'match':'miss'}">â˜…${s}</span> `;
      });
      html+=`</div><div style="font-size:12px;font-weight:700;color:${r.totalMatch>=3?'var(--green)':r.totalMatch>=2?'var(--gold)':'var(--text-dim)'};min-width:40px">${r.totalMatch}/7</div></div>`;
    });
    html+=`</div>`;
  }

  // Grilles
  grids.forEach(g=>{
    html+=`<div class="grid-card">
      <div class="title">${g.name}</div><div class="desc">${g.desc}</div>
      <div class="balls">${g.nums.map(n=>ballHTML(n,"num","",true)).join("")}</div>
      <div class="stars-row"><span class="stars-label">Ã‰toiles :</span>${g.stars.map(s=>ballHTML(s,"star","",true)).join("")}</div>
      ${g.badges?`<div class="score-badges">${g.badges.map(b=>`<span class="score-badge hot">${b}</span>`).join("")}</div>`:""}
    </div>`;
  });

  // DÃ©tails scoring top numÃ©ros
  const {nScores,sScores}=scores;
  const topN=Object.entries(nScores).sort((a,b)=>b[1].total-a[1].total).slice(0,10);
  const topS=Object.entries(sScores).sort((a,b)=>b[1].total-a[1].total).slice(0,5);
  html+=`<div class="card-wrap" style="margin-top:20px">
    <h3 class="section-title">ğŸ”¬ DÃ©tail des scores â€” Top 10 NumÃ©ros</h3>
    <div style="overflow-x:auto"><table style="width:100%;font-size:11px;border-collapse:collapse;font-family:'Space Mono',monospace">
    <tr style="color:var(--gold);border-bottom:1px solid var(--card-border)">
      <th style="padding:6px;text-align:left">NÂ°</th><th>Total</th><th>FrÃ©q</th><th>R20</th><th>R50</th>
      <th>Retard</th><th>Momtm</th><th>Paires</th></tr>`;
  topN.forEach(([n,s])=>{
    html+=`<tr style="color:var(--text-dim);border-bottom:1px solid rgba(255,255,255,0.03)">
      <td style="padding:5px;color:var(--gold);font-weight:700">${n}</td>
      <td style="text-align:center;color:var(--text-bright)">${s.total.toFixed(1)}</td>
      <td style="text-align:center">${s.freq.toFixed(1)}</td>
      <td style="text-align:center;color:${s.recent20>0?'var(--green)':'var(--red)'}">${s.recent20.toFixed(1)}</td>
      <td style="text-align:center">${s.recent50.toFixed(1)}</td>
      <td style="text-align:center;color:${s.overdue>5?'var(--gold)':'var(--text-dim)'}">${s.overdue.toFixed(1)}</td>
      <td style="text-align:center;color:${s.momentum>0?'var(--green)':'var(--red)'}">${s.momentum>0?'+':''}${s.momentum.toFixed(1)}</td>
      <td style="text-align:center">${s.pairs.toFixed(1)}</td></tr>`;
  });
  html+=`</table></div></div>`;

  // Top Ã©toiles
  html+=`<div class="card-wrap">
    <h3 class="section-title">â­ DÃ©tail des scores â€” Top 5 Ã‰toiles</h3>
    <div style="overflow-x:auto"><table style="width:100%;font-size:11px;border-collapse:collapse;font-family:'Space Mono',monospace">
    <tr style="color:var(--gold);border-bottom:1px solid var(--card-border)">
      <th style="padding:6px;text-align:left">â˜…</th><th>Total</th><th>FrÃ©q</th><th>R20</th><th>R50</th><th>Retard</th><th>Momtm</th><th>Paires</th></tr>`;
  topS.forEach(([s,sc])=>{
    html+=`<tr style="color:var(--text-dim);border-bottom:1px solid rgba(255,255,255,0.03)">
      <td style="padding:5px;color:var(--star-yellow);font-weight:700">${s}</td>
      <td style="text-align:center;color:var(--text-bright)">${sc.total.toFixed(1)}</td>
      <td style="text-align:center">${sc.freq.toFixed(1)}</td>
      <td style="text-align:center;color:${sc.recent20>0?'var(--green)':'var(--red)'}">${sc.recent20.toFixed(1)}</td>
      <td style="text-align:center">${sc.recent50.toFixed(1)}</td>
      <td style="text-align:center;color:${sc.overdue>5?'var(--gold)':'var(--text-dim)'}">${sc.overdue.toFixed(1)}</td>
      <td style="text-align:center;color:${sc.momentum>0?'var(--green)':'var(--red)'}">${sc.momentum>0?'+':''}${sc.momentum.toFixed(1)}</td>
      <td style="text-align:center">${sc.pairs.toFixed(1)}</td></tr>`;
  });
  html+=`</table></div></div>`;

  // MÃ©thodologie
  html+=`<div class="card-wrap"><h3 class="section-title">ğŸ§  MÃ©thodologie avancÃ©e â€” 12 facteurs</h3>
    ${[
      ["FrÃ©quence globale (12%)","Ratio d'apparitions vs espÃ©rance thÃ©orique sur tout l'historique"],
      ["FrÃ©quence 20 derniers (20%)","Poids fort sur la tendance trÃ¨s rÃ©cente"],
      ["FrÃ©quence 50 derniers (15%)","Tendance moyen terme"],
      ["FrÃ©quence 100 derniers (10%)","Tendance long terme"],
      ["Retard + Ã©cart-type (18%)","Gap actuel vs gap moyen â€” bonus si dÃ©passe gap+Ïƒ"],
      ["Momentum (10%)","AccÃ©lÃ©ration : frÃ©quence 20 vs frÃ©quence 50"],
      ["Paires frÃ©quentes (8%)","NumÃ©ros qui apparaissent souvent ensemble"],
      ["Ã‰quilibre somme (5%)","Favorise les numÃ©ros contribuant Ã  une somme proche de la moyenne"],
      ["VÃ©rification paritÃ©","Filtrage : idÃ©alement 2I/3P ou 3I/2P"],
      ["VÃ©rification consÃ©cutifs","Limite Ã  maximum 1 paire de numÃ©ros consÃ©cutifs"],
      ["Optimisation dizaines","Couverture de toutes les tranches de 10"],
      ["Suivi performance","Comparaison automatique prÃ©dictions vs rÃ©sultats rÃ©els"],
    ].map(([t,d])=>`<div class="method-item"><span class="dot">â—</span> <strong>${t}</strong> â€” ${d}</div>`).join("")}
  </div>`;

  document.getElementById("panel-predictions").innerHTML=html;
}

function renderFrequences(analysis) {
  const {nF,sF}=analysis;
  const maxN=Math.max(...Object.values(nF));const maxS=Math.max(...Object.values(sF));
  const sortedN=Object.entries(nF).sort((a,b)=>b[1]-a[1]);
  const sortedS=Object.entries(sF).sort((a,b)=>b[1]-a[1]);
  const top5=new Set(sortedN.slice(0,5).map(e=>e[0]));
  const top3S=new Set(sortedS.slice(0,3).map(e=>e[0]));
  let html=`<h3 class="section-title">FrÃ©quence des numÃ©ros (1-50)</h3><div class="card-wrap">`;
  sortedN.forEach(([num,count])=>{const t=top5.has(num);const pct=(count/maxN*100).toFixed(1);
    html+=`<div class="freq-row"><span class="freq-label ${t?'top':''}">${num}</span>
      <div class="freq-track"><div class="freq-fill ${t?'top':''}" style="width:${pct}%"></div></div>
      <span class="freq-count ${t?'top':''}">${count}</span></div>`;});
  html+=`</div><h3 class="section-title">FrÃ©quence des Ã©toiles (1-12)</h3><div class="card-wrap">`;
  sortedS.forEach(([num,count])=>{const t=top3S.has(num);const pct=(count/maxS*100).toFixed(1);
    html+=`<div class="freq-row"><span class="freq-label ${t?'top':''}">${num}</span>
      <div class="freq-track"><div class="freq-fill ${t?'top':''}" style="width:${pct}%"></div></div>
      <span class="freq-count ${t?'top':''}">${count}</span></div>`;});
  html+=`</div><h3 class="section-title">ğŸ† Top 10 des numÃ©ros</h3><div class="top10">`;
  sortedN.slice(0,10).forEach(([num,count],i)=>{
    html+=`<div class="top10-item ${i<3?'podium':''}"><div class="top10-rank">#${i+1}</div>
      ${ballHTML(+num,"num","sm",i<3)}<div class="top10-count">${count}Ã—</div></div>`;});
  html+=`</div>`;
  // Top paires
  const topPairs=Object.entries(analysis.pairF).filter(([k])=>!k.includes("s")).sort((a,b)=>b[1]-a[1]).slice(0,10);
  html+=`<h3 class="section-title" style="margin-top:24px">ğŸ”— Top 10 Paires les plus frÃ©quentes</h3><div class="card-wrap">`;
  topPairs.forEach(([pair,count],i)=>{const [a,b]=pair.split("-");
    html+=`<div style="display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.03)">
      <span style="width:24px;color:${i<3?'var(--gold)':'var(--text-dim)'};font-size:11px;font-family:'Space Mono',monospace">#${i+1}</span>
      ${ballHTML(+a,"num","xs",i<3)} ${ballHTML(+b,"num","xs",i<3)}
      <span style="font-size:12px;color:var(--text-dim);font-family:'Space Mono',monospace;margin-left:auto">${count}Ã—</span></div>`;});
  html+=`</div>`;
  document.getElementById("panel-frequences").innerHTML=html;
}

function renderStats(analysis) {
  const {T,nF,sF,decF,sums,oddEvenDist,consecCount,chiSqN,chiSqS}=analysis;
  const avgSum=Math.round(sums.reduce((a,b)=>a+b,0)/sums.length);
  const sortedN=Object.entries(nF).sort((a,b)=>b[1]-a[1]);
  const sortedS=Object.entries(sF).sort((a,b)=>b[1]-a[1]);
  const firstDate=allDraws[allDraws.length-1]?.date||"â€”";const lastDate=allDraws[0]?.date||"â€”";
  let html=`<div class="stat-grid">
    <div class="stat-card"><div class="label">ğŸ“… Tirages</div><div class="value">${T}</div><div class="sub">${firstDate} â†’ ${lastDate}</div></div>
    <div class="stat-card"><div class="label">â• Somme moy.</div><div class="value">${avgSum}</div><div class="sub">des 5 numÃ©ros</div></div>
    <div class="stat-card"><div class="label">ğŸ”¥ NÂ° + frÃ©quent</div><div class="value">${sortedN[0][0]}</div><div class="sub">${sortedN[0][1]}Ã—</div></div>
    <div class="stat-card"><div class="label">â­ Ã‰toile fav.</div><div class="value">${sortedS[0][0]}</div><div class="sub">${sortedS[0][1]}Ã—</div></div>
    <div class="stat-card"><div class="label">ğŸ“ ChiÂ² nums</div><div class="value">${chiSqN.toFixed(1)}</div><div class="sub">49 dl, seuil ~67</div></div>
    <div class="stat-card"><div class="label">ğŸ“ ChiÂ² stars</div><div class="value">${chiSqS.toFixed(1)}</div><div class="sub">11 dl, seuil ~20</div></div>
  </div>`;
  html+=`<h3 class="section-title">Distribution par dizaine</h3><div class="card-wrap">`;
  const totalDec=Object.values(decF).reduce((a,b)=>a+b,0);
  Object.entries(decF).forEach(([r,c])=>{const p=(c/totalDec*100).toFixed(1);
    html+=`<div class="progress-row"><div class="progress-header"><span class="lbl">${r}</span><span class="val">${p}%</span></div>
      <div class="progress-track"><div class="progress-fill" style="width:${p}%"></div></div></div>`;});
  html+=`</div><h3 class="section-title">RÃ©partition Impair / Pair</h3><div class="card-wrap">`;
  Object.entries(oddEvenDist).sort((a,b)=>b[1]-a[1]).forEach(([k,c])=>{const p=(c/T*100).toFixed(1);
    html+=`<div class="progress-row"><div class="progress-header"><span class="lbl">${k}</span><span class="val">${p}% (${c}Ã—)</span></div>
      <div class="progress-track"><div class="progress-fill" style="width:${p}%;background:linear-gradient(90deg,#2255aa88,#3377cc)"></div></div></div>`;});
  html+=`</div>`;
  const sortedSums=[...sums].sort((a,b)=>a-b);
  html+=`<div class="card-wrap"><h3 class="section-title">ğŸ“ Distribution des sommes</h3>
    <div class="stat-grid">
      ${[["Min",Math.min(...sums)],["Max",Math.max(...sums)],["Moyenne",avgSum],["MÃ©diane",sortedSums[Math.floor(sums.length/2)]]].map(([l,v])=>
        `<div class="stat-card"><div class="label">${l}</div><div class="value">${v}</div></div>`).join("")}
    </div>
    <div style="margin-top:12px;font-size:12px;color:var(--text-dim)">
      ConsÃ©cutifs moyens par tirage : <strong style="color:var(--gold)">${(consecCount/T).toFixed(2)}</strong>
    </div></div>`;
  document.getElementById("panel-stats").innerHTML=html;
}

function renderHistorique(draws,count=30) {
  let html=`<div class="history-controls"><h3>Derniers tirages</h3><div style="display:flex;gap:10px;align-items:center">
    <button class="refresh-btn" onclick="handleCalcButton()">â†» MAJ + Calcul</button>
    <select class="history-select" onchange="renderHistorique(allDraws,+this.value)">
      ${[10,20,30,50,100,200].map(n=>`<option value="${n}" ${n===count?'selected':''}>${n} tirages</option>`).join("")}
    </select></div></div><div>`;
  draws.slice(0,count).forEach(d=>{
    html+=`<div class="draw-row"><div class="draw-date">${d.date}</div>
      <div class="draw-balls">${d.numbers.map(n=>ballHTML(n,"num","sm")).join("")}</div>
      <div class="draw-balls">${d.stars.map(s=>ballHTML(s,"star","xs")).join("")}</div></div>`;});
  html+=`</div>`;
  document.getElementById("panel-historique").innerHTML=html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT & NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-panel").forEach(p=>p.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("panel-"+btn.dataset.tab).classList.add("active");
  });
});

async function handleCalcButton() {
  const btn=document.getElementById("calc-btn");
  btn.classList.add("loading");
  updateStatus(true,"Mise Ã  jour et recalcul en cours...");
  try{
    try{localStorage.removeItem(CACHE_KEY)}catch(e){}
    allDraws=await fetchDraws();
    renderAll();
    setTimeout(()=>{document.querySelectorAll(".grid-card").forEach((c,i)=>{
      setTimeout(()=>c.classList.add("calc-result-flash"),i*120);});},100);
    updateStatus(true,`âœ… ${allDraws.length} tirages â€” Recalcul Ã  ${new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`);
  } catch(e){updateStatus(false,"Erreur lors de la MÃ J");renderAll();}
}

function renderAll() {
  const analysis=analyzeDraws(allDraws);
  const scores=scoreNumbers(analysis,allDraws);
  const grids=generateGrids(scores,analysis,allDraws);
  // Sauvegarder les prÃ©dictions pour vÃ©rification future
  savePredictions(grids);
  document.getElementById("header-sub").innerHTML=
    `<strong>${allDraws.length} tirages</strong> analysÃ©s â€” Dernier : ${allDraws[0]?.date||"â€”"} â€¢ 12 facteurs d'analyse`;
  renderPredictions(grids,scores,analysis);
  renderFrequences(analysis);
  renderStats(analysis);
  renderHistorique(allDraws,30);
}

(async function init(){
  try{
    allDraws=await fetchDraws();
    document.getElementById("loader").style.display="none";
    document.getElementById("app").style.display="block";
    renderAll();
  }catch(err){
    document.getElementById("loader").innerHTML=`<div class="error-box">
      <div class="err-title">Erreur de chargement</div>
      <div class="err-msg">${err.message||"Impossible de rÃ©cupÃ©rer les donnÃ©es"}</div>
      <button class="retry-btn" onclick="location.reload()">RÃ©essayer</button></div>`;
    updateStatus(false,"Erreur de connexion");
  }
})();
setInterval(async()=>{try{localStorage.removeItem(CACHE_KEY);allDraws=await fetchDraws();renderAll()}catch(e){}},3600000);
</script>
</body>
</html>
